/**
 * Satellizer 0.12.5
 * (c) 2014-2015 Sahat Yalkabov
 * License: MIT
 */
!function(a,b,c){"use strict";b.module("satellizer",[]).constant("SatellizerConfig",{httpInterceptor:!0,withCredentials:!0,tokenRoot:null,cordova:!1,baseUrl:"/",loginUrl:"/auth/login",signupUrl:"/auth/signup",unlinkUrl:"/auth/unlink/",tokenName:"token",tokenPrefix:"satellizer",authHeader:"Authorization",authToken:"Bearer",storageType:"localStorage",providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v2.3/dialog/oauth",redirectUri:(a.location.origin||a.location.protocol+"//"+a.location.host)+"/",requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",type:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",type:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",authorizationEndpoint:"https://api.instagram.com/oauth/authorize"},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/uas/oauth2/authorization",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",type:"2.0",popupOptions:{width:527,height:582}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,type:"1.0",popupOptions:{width:495,height:645}},twitch:{name:"twitch",url:"/auth/twitch",authorizationEndpoint:"https://api.twitch.tv/kraken/oauth2/authorize",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,requiredUrlParams:["scope"],scope:["user_read"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",type:"2.0",popupOptions:{width:500,height:560}},yahoo:{name:"yahoo",url:"/auth/yahoo",authorizationEndpoint:"https://api.login.yahoo.com/oauth2/request_auth",redirectUri:a.location.origin||a.location.protocol+"//"+a.location.host,scope:[],scopeDelimiter:",",type:"2.0",popupOptions:{width:559,height:519}}}}).provider("$auth",["SatellizerConfig",function(a){Object.defineProperties(this,{httpInterceptor:{get:function(){return a.httpInterceptor},set:function(b){a.httpInterceptor=b}},baseUrl:{get:function(){return a.baseUrl},set:function(b){a.baseUrl=b}},loginUrl:{get:function(){return a.loginUrl},set:function(b){a.loginUrl=b}},signupUrl:{get:function(){return a.signupUrl},set:function(b){a.signupUrl=b}},tokenRoot:{get:function(){return a.tokenRoot},set:function(b){a.tokenRoot=b}},tokenName:{get:function(){return a.tokenName},set:function(b){a.tokenName=b}},tokenPrefix:{get:function(){return a.tokenPrefix},set:function(b){a.tokenPrefix=b}},unlinkUrl:{get:function(){return a.unlinkUrl},set:function(b){a.unlinkUrl=b}},authHeader:{get:function(){return a.authHeader},set:function(b){a.authHeader=b}},authToken:{get:function(){return a.authToken},set:function(b){a.authToken=b}},withCredentials:{get:function(){return a.withCredentials},set:function(b){a.withCredentials=b}},cordova:{get:function(){return a.cordova},set:function(b){a.cordova=b}},storageType:{get:function(){return a.storageType},set:function(b){a.storageType=b}}}),b.forEach(Object.keys(a.providers),function(c){this[c]=function(d){return b.extend(a.providers[c],d)}},this);var c=function(c){a.providers[c.name]=a.providers[c.name]||{},b.extend(a.providers[c.name],c)};this.oauth1=function(b){c(b),a.providers[b.name].type="1.0"},this.oauth2=function(b){c(b),a.providers[b.name].type="2.0"},this.$get=["$q","SatellizerShared","SatellizerLocal","SatellizerOauth",function(a,b,c,d){var e={};return e.login=function(a,b){return c.login(a,b)},e.signup=function(a,b){return c.signup(a,b)},e.logout=function(){return b.logout()},e.authenticate=function(a,b){return d.authenticate(a,b)},e.link=function(a,b){return d.authenticate(a,b)},e.unlink=function(a,b){return d.unlink(a,b)},e.isAuthenticated=function(){return b.isAuthenticated()},e.getToken=function(){return b.getToken()},e.setToken=function(a){b.setToken({access_token:a})},e.removeToken=function(){return b.removeToken()},e.getPayload=function(){return b.getPayload()},e.setStorageType=function(a){return b.setStorageType(a)},e}]}]).factory("SatellizerShared",["$q","$window","SatellizerConfig","SatellizerStorage",function(c,d,e,f){var g={},h=e.tokenPrefix?[e.tokenPrefix,e.tokenName].join("_"):e.tokenName;return g.getToken=function(){return f.get(h)},g.getPayload=function(){var b=f.get(h);if(b&&3===b.split(".").length){var c=b.split(".")[1],d=c.replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(decodeURIComponent(escape(a.atob(d))))}},g.setToken=function(a){var d,c=a&&a.access_token;if(c&&(b.isObject(c)&&b.isObject(c.data)?a=c:b.isString(c)&&(d=c)),!d&&a){var g=e.tokenRoot&&e.tokenRoot.split(".").reduce(function(a,b){return a[b]},a.data);d=g?g[e.tokenName]:a.data[e.tokenName]}if(!d){var i=e.tokenRoot?e.tokenRoot+"."+e.tokenName:e.tokenName;throw new Error('Expecting a token named "'+i+'" but instead got: '+JSON.stringify(a.data))}f.set(h,d)},g.removeToken=function(){f.remove(h)},g.isAuthenticated=function(){var a=f.get(h);if(a){if(3===a.split(".").length){var b=a.split(".")[1],c=b.replace(/-/g,"+").replace(/_/g,"/"),e=JSON.parse(d.atob(c)).exp;if(e){var g=Math.round((new Date).getTime()/1e3)>=e;return g?(f.remove(h),!1):!0}return!0}return!0}return!1},g.logout=function(){return f.remove(h),c.when()},g.setStorageType=function(a){e.storageType=a},g}]).factory("SatellizerOauth",["$q","$http","SatellizerConfig","SatellizerUtils","SatellizerShared","SatellizerOauth1","SatellizerOauth2",function(a,b,c,d,e,f,g){var h={};return h.authenticate=function(b,d){var h="1.0"===c.providers[b].type?new f:new g,i=a.defer();return h.open(c.providers[b],d||{}).then(function(a){e.setToken(a,!1),i.resolve(a)})["catch"](function(a){i.reject(a)}),i.promise},h.unlink=function(a,e){return e=e||{},e.url=c.baseUrl?d.joinUrl(c.baseUrl,c.unlinkUrl):c.unlinkUrl,e.data={provider:a}||e.data,e.method=e.method||"POST",b(e)},h}]).factory("SatellizerLocal",["$http","SatellizerUtils","SatellizerShared","SatellizerConfig",function(a,b,c,d){var e={};return e.login=function(e,f){return f=f||{},f.url=d.baseUrl?b.joinUrl(d.baseUrl,d.loginUrl):d.loginUrl,f.data=e||f.data,f.method=f.method||"POST",a(f).then(function(a){return c.setToken(a),a})},e.signup=function(c,e){return e=e||{},e.url=d.baseUrl?b.joinUrl(d.baseUrl,d.signupUrl):d.signupUrl,e.data=c||e.data,e.method=e.method||"POST",a(e)},e}]).factory("SatellizerOauth2",["$q","$http","$window","SatellizerPopup","SatellizerUtils","SatellizerConfig","SatellizerStorage",function(a,c,d,e,f,g,h){return function(){var d={},i={defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}};return d.open=function(c,j){i=f.merge(c,i);var k,l,m=i.name+"_state";return b.isFunction(i.state)?h.set(m,i.state()):b.isString(i.state)&&h.set(m,i.state),k=[i.authorizationEndpoint,d.buildQueryString()].join("?"),l=g.cordova?e.open(k,i.name,i.popupOptions,i.redirectUri).eventListener(i.redirectUri):e.open(k,i.name,i.popupOptions,i.redirectUri).pollPopup(),l.then(function(b){return"token"===i.responseType?b:b.state&&b.state!==h.get(m)?a.reject('OAuth "state" mismatch'):d.exchangeForToken(b,j)})},d.exchangeForToken=function(a,d){var e=b.extend({},d);b.forEach(i.responseParams,function(b,c){switch(c){case"code":e[b]=a.code;break;case"clientId":e[b]=i.clientId;break;case"redirectUri":e[b]=i.redirectUri;break;default:e[b]=a[c]}}),a.state&&(e.state=a.state);var h=g.baseUrl?f.joinUrl(g.baseUrl,i.url):i.url;return c.post(h,e,{withCredentials:g.withCredentials})},d.buildQueryString=function(){var a=[],c=["defaultUrlParams","requiredUrlParams","optionalUrlParams"];return b.forEach(c,function(c){b.forEach(i[c],function(c){var d=f.camelCase(c),e=b.isFunction(i[c])?i[c]():i[d];if("state"===c){var g=i.name+"_state";e=encodeURIComponent(h.get(g))}"scope"===c&&Array.isArray(e)&&(e=e.join(i.scopeDelimiter),i.scopePrefix&&(e=[i.scopePrefix,e].join(i.scopeDelimiter))),a.push([c,e])})}),a.map(function(a){return a.join("=")}).join("&")},d}}]).factory("SatellizerOauth1",["$q","$http","SatellizerPopup","SatellizerConfig","SatellizerUtils",function(a,c,d,e,f){return function(){var a={},g={url:null,name:null,popupOptions:null,redirectUri:null,authorizationEndpoint:null};return a.open=function(h,i){b.extend(g,h);var j,k=e.baseUrl?f.joinUrl(e.baseUrl,g.url):g.url;return e.cordova||(j=d.open("",g.name,g.popupOptions,g.redirectUri)),c.post(k,g).then(function(b){e.cordova?j=d.open([g.authorizationEndpoint,a.buildQueryString(b.data)].join("?"),g.name,g.popupOptions,g.redirectUri):j.popupWindow.location=[g.authorizationEndpoint,a.buildQueryString(b.data)].join("?");var c=e.cordova?j.eventListener(g.redirectUri):j.pollPopup();return c.then(function(b){return a.exchangeForToken(b,i)})})},a.exchangeForToken=function(a,d){var h=b.extend({},d,a),i=e.baseUrl?f.joinUrl(e.baseUrl,g.url):g.url;return c.post(i,h,{withCredentials:e.withCredentials})},a.buildQueryString=function(a){var c=[];return b.forEach(a,function(a,b){c.push(encodeURIComponent(b)+"="+encodeURIComponent(a))}),c.join("&")},a}}]).factory("SatellizerPopup",["$q","$interval","$window","SatellizerConfig","SatellizerUtils",function(d,e,f,g,h){var i={};return i.url="",i.popupWindow=null,i.open=function(b,c,d){i.url=b;var e=i.stringifyOptions(i.prepareOptions(d)),f=g.cordova?"_blank":c;return i.popupWindow=a.open(b,f,e),a.popup=i.popupWindow,i.popupWindow&&i.popupWindow.focus&&i.popupWindow.focus(),i},i.eventListener=function(a){var c=d.defer();return i.popupWindow.addEventListener("loadstart",function(d){if(0===d.url.indexOf(a)){var e=document.createElement("a");if(e.href=d.url,e.search||e.hash){var f=e.search.substring(1).replace(/\/$/,""),g=e.hash.substring(1).replace(/\/$/,""),j=h.parseQueryString(g),k=h.parseQueryString(f);b.extend(k,j),k.error||c.resolve(k),i.popupWindow.close()}}}),i.popupWindow.addEventListener("loaderror",function(){c.reject("Authorization Failed")}),c.promise},i.pollPopup=function(){var f=d.defer();a.onmessage=function(a){var c=a.data.queryParams,d=a.data.hashParams,j=h.parseQueryString(d),k=h.parseQueryString(c);b.extend(k,j),k.error||f.resolve(k),i.popupWindow.close(),e.cancel(g)};var g=e(function(){try{var a=document.location.host,d=i.popupWindow.location.host;if(d===a&&(i.popupWindow.location.search||i.popupWindow.location.hash)){var j=i.popupWindow.location.search.substring(1).replace(/\/$/,""),k=i.popupWindow.location.hash.substring(1).replace(/[\/$]/,""),l=h.parseQueryString(k),m=h.parseQueryString(j);b.extend(m,l),m.error||f.resolve(m),i.popupWindow.close(),e.cancel(g)}}catch(n){}(!i.popupWindow||i.popupWindow.closed||i.popupWindow.closed===c)&&(e.cancel(g),f.reject({}))},50);return f.promise},i.prepareOptions=function(a){a=a||{};var c=a.width||500,d=a.height||500;return b.extend({width:c,height:d,left:f.screenX+(f.outerWidth-c)/2,top:f.screenY+(f.outerHeight-d)/2.5},a)},i.stringifyOptions=function(a){var c=[];return b.forEach(a,function(a,b){c.push(b+"="+a)}),c.join(",")},i}]).service("SatellizerUtils",function(){this.camelCase=function(a){return a.replace(/([\:\-\_]+(.))/g,function(a,b,c,d){return d?c.toUpperCase():c})},this.parseQueryString=function(a){var d,e,c={};return b.forEach((a||"").split("&"),function(a){a&&(e=a.split("="),d=decodeURIComponent(e[0]),c[d]=b.isDefined(e[1])?decodeURIComponent(e[1]):!0)}),c},this.joinUrl=function(a,b){if(/^(?:[a-z]+:)?\/\//i.test(b))return b;var c=[a,b].join("/"),d=function(a){return a.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")};return d(c)},this.merge=function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&(d in b&&"object"==typeof a[d]&&null!==d?c[d]=this.merge(a[d],b[d]):c[d]=a[d]);for(d in b)if(b.hasOwnProperty(d)){if(d in c)continue;c[d]=b[d]}return c}}).factory("SatellizerStorage",["$window","SatellizerConfig",function(a,b){var d=function(){try{var c=b.storageType in a&&null!==a[b.storageType];if(c){var d=Math.random().toString(36).substring(7);a[b.storageType].setItem(d,""),a[b.storageType].removeItem(d)}return c}catch(e){return!1}}();return d||console.warn("Satellizer Warning: "+b.storageType+" is not available."),{get:function(e){return d?a[b.storageType].getItem(e):c},set:function(e,f){return d?a[b.storageType].setItem(e,f):c},remove:function(e){return d?a[b.storageType].removeItem(e):c}}}]).factory("SatellizerInterceptor",["$q","SatellizerConfig","SatellizerStorage","SatellizerShared",function(a,b,c,d){return{request:function(a){if(a.skipAuthorization)return a;if(d.isAuthenticated()&&b.httpInterceptor){var e=b.tokenPrefix?b.tokenPrefix+"_"+b.tokenName:b.tokenName,f=c.get(e);b.authHeader&&b.authToken&&(f=b.authToken+" "+f),a.headers[b.authHeader]=f}return a},responseError:function(b){return a.reject(b)}}}]).config(["$httpProvider",function(a){a.interceptors.push("SatellizerInterceptor")}])}(window,window.angular);